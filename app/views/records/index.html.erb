<div class="col-md-12">
    <div class="card">
        <div class="card-header">
            <h5>Búsqueda general</h5>
        </div>
        <div class="card-block">
            <%= search_form_for @q do |f| %>


            <div class="row">
              <div class="col-md-4">
                <div class="form-group">
                    <label>Registro:</label>
                    <%= f.search_field :id_eq, placeholder: "Buscar número de registro", class: "form-control" %>
                </div>
              </div>

              <div class="col-md-4">
                <div class="form-group">
                    <label>Cliente:</label>
                    <%= f.search_field :client_razon_social_or_client_rfc_or_client_alias_cont, placeholder: "Buscar cliente por Razón Social, R.F.C o Alias", class: "form-control"  %>
                </div>
              </div>
              <div class="col-md-4">
                  <div class="form-group">
                      <%= f.label :Status %>
                      <%= f.select :status_eq, Record.statuses, {prompt: 'Select status'}, {class: "form-control"} %>
                  </div>
              </div>

            </div>

            <div class="row">
              <div class="col-md-4">
                <div class="form-group">
                    <label>Autobús:</label>
                    <%= f.search_field :buses_numero_or_buses_capacidad_eq, placeholder: "Buscar número de autubús o capacidad", class: "form-control"  %>
                </div>
              </div>

              <div class="col-md-4">
                <div class="form-group">
                    <label>Marca:</label>
                    <%= f.search_field :buses_marca_cont, placeholder: "Buscar marca de autubús", class: "form-control"  %>
                </div>
              </div>

              <div class="col-md-4">
                <div class="form-group">
                    <label>Operador:</label>
                    <%= f.search_field :buses_operator_nombre_cont, placeholder: "Buscar nombre de operador", class: "form-control"  %>
                </div>
              </div>

            </div>
            <br>
            <div class="row">
              <div class="col-md-3">
                <%= f.submit "Buscar", class: "btn btn-primary" %>
              </div>
            </div>
            <% end %> 
        </div>
    </div>
</div>

<div class="col-md-12">
    <div class="card">
        <div class="card-header">
            <h5 class="mr-3">Registro Histórico</h5>
            <% @years.reverse.each do |year| %>
              <% if year.to_s == @year.to_s %>
                <span class="mr-3"><%= year %></span>
              <% else %>
                <%= link_to year, records_path(year: year), class: "mr-3" %>
              <% end %>
            <% end %>
        </div>
        <div class="card-block">
        <label>Ordenar por:</label>
        <div id="filtro">
          <span class="mr-4"><%= sort_link(@q, :id, 'Folio', default_order: :desc) %></span>
          <span class="mr-4"><%= sort_link(@q, :start_time, 'Fechas', default_order: :desc) %></span>
          <span class="mr-4"><%= sort_link(@q, :numero_pasajeros, 'Número Pasajeros', default_order: :desc) %></span>
          <span class="mr-4"><%= sort_link(@q, :sum_total, '% Completo', default_order: :desc) %></span>
        </div>
        <div class="table-responsive mt-4">
          <table class="table">
            <thead>
              <th>I.D</th>
              <th>Fecha de<br>Inicio</th>
              <th>Fecha de<br>Regreso</th>
              <th>Referencia</th>
              <th>Cliente</th>
              <th>R.F.C</th>
              <th>Numero<br>pasajeros</th>
              <th>Numero de<br>camiones</th>
              <th>Luagr de<br>Salida</th>
              <th>Precio</th>
              <th>Pagos</th>
              <th>Status op</th>
              <th>Status<br>admin</th>
              <th>% Completo</th>
              <th>Status</th>
              <th colspan="3"></th>
            </thead>
            <tbody>
              <% @records.each do |record| %>
              <tr>
                <td><%= record.try(:id)%></td>
                <td><%= record.try(:start_time).strftime(" %b-%d-%Y") %></td>
                <td><%= record.try(:end_time).strftime(" %b-%d-%Y") %></td>
                <td><%= record.try(:title) %></td>
                <td><%= record.client.try(:razon_social) %></td>
                <td><%= record.client.try(:rfc) %></td>
                <td><%= record.try(:numero_pasajeros) %></td>
                <td><%= record.try(:numero_de_camiones) %></td>
                <td><%= record.try(:lugar_salida) %></td>
                <td><%= record.try(:precio_final) %></td>
                <td><%= record.try(:sum_payments) %></td>
                <td><%= record.try(:status_op) %></td>
                <% if record.try(:status_admin) == true %>
                <td class="green">Cobrado</td>
                <% else %>
                <td class="red">Por Cobrar</td>
                <% end %>
                <td><%= record.sum_total %> % </td>
                <td class="text-center"><span class="label theme-bg f-12 text-white" style="border-radius: 15px;box-shadow: 0 5px 10px 0 rgba(0, 0, 0, 0.2);"><%= record.status %></span></td>
                <%
                  status = record.status
                  if status == 'Abierto'
                    path = edit_record_path(record)
                  elsif status == 'Cliente'
                    path = client_record_path(record)
                  elsif status == 'Itinerario'
                    path = itinerary_record_path(record)
                  elsif status == 'Adicional'
                    path = trip_record_path(record)
                  elsif status == 'Autobuses'
                    path = bus_record_path(record)
                  elsif status == 'Precios'
                    path = price_record_path(record)
                  elsif status == 'Pagos'
                    path = payments_record_path(record)
                  else
                    path = pdf_record_path(record)
                  end
                %>
                <td><%= link_to 'Ver más', path %></td>
                <td><%= link_to 'Eliminar', record, method: :delete, data: { confirm: 'Are you sure?' } %></td>
              </tr>
              <% end %>
            </tbody>
          </table>
          <div style="display:flex; justify-content:center; align-items:center;">
              <% unless @records.blank? %>
                  <%= will_paginate @records, renderer: WillPaginate::ActionView::BootstrapLinkRenderer %>
              <% end %>
          </div>
        </div>     
        </div>
    </div>
</div>
